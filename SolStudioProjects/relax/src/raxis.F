      SUBROUTINE RAXIS(X,Y,S,THETA,XMIN,DX,IBCD,N)
C======================================================================C
C
C  RELAX3D modified version of AXISS_TPLT by C.J. Kost.
C
C======================================================================C
      INTEGER*2 IBCD(1)
      INTEGER*2 IEXP(2)

      COMMON/RCIL/IPENX,IPENY,IPS,IPC,IPCN,FACR,XM,SIZES,SIZEN,SIZEL,
     #  TICK,STEP,XSPAC,IPNAB,ITAPE,IB,IBC,IBYTE,IBASE,IMMET
      COMMON/RNCAXIS/NCBT,NDEC,NDIG

      DATA IEXP(1)/'*1'/,IEXP(2)/'0 '/
C           WIDTH OF CHARACTERS (LABEL)

      XMAX=XMIN+DX*S*FACR
      DXIMMET=DX*IMMET
      SIZEW=SIZEL*0.857143
      ANG=THETA*0.0174533
      CTH=COS(ANG)
      STH=SIN(ANG)
C           ENSURE INTEGRAL VALUE OF S IS .GE. 1.0
      IF (S) 10,10,20
C
C    FOR CASE S .LE. 0. WE HAVE LOG10 SCALE
C
10    XS= FLOAT(INT(ABS(S)+.5))
      NTIC=XS+1.0
      GOTO 50
20    I=ABS(S)+0.5
      XS=I
      IF(XS-1.0)30,40,40
30    XS=1.0
40    NTIC=XS+1.0
50    KN=N
      A=-1.0
C           POSITIVE N FOR ANNOTATION ON CLOCKWISE SIDE OF AXIS
      IF(KN)60,70,70
60    A=-A
      KN=-KN
C           DETERMINE DECIMAL EXPONENT
70    EX=0.0
      ADX=ABS(DX)*IMMET
C
C    IF DX=0 DRAW AXIS WITHOUT ANNOTATIONS BUT WITH TICKS
C    ON SIDE DETERMINED BY SIGN OF "N"
      IF(ADX.EQ.0.) GO TO 320
      X0= XMIN
      IF (S.LT.0.) GOTO 130
C
C   USE NDIG & NDEC TO DETERMINE THE USE OF AN EXPONENT EX.
C
C
C    CHECK THAT THE NUMBERS WILL FIT IN THE FIELD OF NDIG
C
80    IF(DX.NE.0.)CALL FNICE(XMIN,XMAX,DXIMMET,NDIG,NDEC,IPOW)
C     WRITE(6,177)XMIN,XMAX,DXIMMET,NDIG,NDEC,IPOW
177   FORMAT(3F12.4,3I6)
      EX=IPOW
120   ADX=10.0**(-EX)
      X0=XMIN*ADX
      ADX=DX*ADX
C           DETERMINE POSITION OF ANNOTATION
130   DXN=-SIZEN*(NDIG-1.)/2.
C     IF(NDEC.GE.0)DXN=DXN+SIZEN*1.0       !   NEW ON JUN 23 1982
      DYN=(TICK+SIZEN)*A-0.5*SIZEN
      XN=X+DXN*CTH-DYN*STH
      YN=Y+DYN*CTH+DXN*STH
      NT=NTIC/2
      CONST=IMMET
C
C    MODIFY STANDARD AXIS ROUTINE TO PLOT NUMBERS HOROZONTALLY
C    FOR A VERTICAL (THETA=90. DEGR. ) AXIS.
C
      IF(THETA.NE. 90.0) GO TO 210
      IF(A.LT.0.)XN=X+TICK+0.5*SIZEN
      IF(A.GT.0.)XN=X-TICK-SIZEN*(NDIG+0.5)
      IF(A.GT.0. .AND. S .LT. 0.)XN=X-TICK-3.5*SIZEN
      YN=Y-0.5*SIZEN
      DO 170 I=1,NTIC,IMMET
      IF(S)140,140,150
140   TEN=10.
      CALL RNUM(XN,YN,SIZEN,TEN,0.0,-1)
      XT=XN+1.8*SIZEN
      YT=YN+0.7*SIZEN
      CALL RNUM(XT,YT,SIZEN/2.,X0,0.,-1)
      X0=X0+DX*IMMET
      GO TO 160
150   CALL RNUMR(XN,YN,SIZEN,X0,0.,NDEC)
      X0=X0+ADX*CONST
160   XN=XN
      YN=YN+CONST
170   CONTINUE
      IF(KN)190,190,180
C
C   WRITE Y LABEL AT TOP
C
180   CALL PSYM(X,Y+S+TICK+SIZEL/2.,SIZEL,IBCD,0.,KN)
190   IF(EX)200,320,200
C
C   WRITE DECIMAL EXPONENT
C
200   CALL PSYM(X+(KN+1)*SIZEW,Y+S+TICK+SIZEL/2.,SIZEL,IEXP,0.,3)
      CALL RNUM(X+(KN+4.0)*SIZEW,Y+S+TICK+SIZEL,SIZEL/2.,EX,0.,0)
      GO TO 320
C
C   NOTE:  FOR AXIS CALLED FROM TPLT IMMET=#CELLS BETWEEN
C          LABELLED TICKS (NCBT*NTBL)
C
C
C           WRITE NUMERIC INTERVALS
C
210   DO 310 I=1,NTIC,IMMET
      IF (S) 220,220,230
220   TEN=10.
      CALL RNUM(XN,YN,SIZEN,TEN,THETA,0)
      XT=XN+1.8*CTH*SIZEN-.6*SIZEN*STH
      YT=YN+1.8*STH*SIZEN+.6*SIZEN*CTH
      CALL RNUM(XT,YT,SIZEN/2.,X0,THETA,0)
      X0=X0+DX*IMMET
      GOTO 240
230   CALL RNUM(XN,YN,SIZEN,X0,THETA,NDEC)
      X0=X0+ADX*CONST
240   XN=XN+CTH*CONST
      YN=YN+STH*CONST
      IF(NT)250,250,310
C      WRITE AXIS LABEL
250   NT=NTIC*IMMET
      L=KN
      IF(EX)260,270,260
260   L=L+6
270   Z=L/2
      DXB=XS*0.5-Z*SIZEW
      DYB=(TICK+SIZEN+SIZEL)*A*1.2-0.5*SIZEL
      XT=X+DXB*CTH-DYB*STH
      YT=Y+DYB*CTH+DXB*STH
      IF(KN)290,290,280
280   CALL PSYM(XT,YT,SIZEL,IBCD,THETA,KN)
290   IF(EX)300,310,300
C           WRITE DECIMAL EXPONENT
300   Z=KN+1
      XT=XT+Z*CTH*SIZEW
      YT=YT+Z*STH*SIZEW
      CALL PSYM(XT,YT,SIZEL,IEXP,THETA,3)
      XT=XT+3.0*CTH*SIZEW-0.5*SIZEL*STH
      YT=YT+3.0*STH*SIZEW+0.5*SIZEL*CTH
      CALL RNUM(XT,YT,SIZEL/2.0,EX,THETA,0)
310   NT=NT-IMMET
C           DRAW TICK MARKS AND AXIS
320   XN=X
      YN=Y
      CALL PLOT_R(XN,YN,3)
D     WRITE(6,*)'AXIS',XN,YN,3
      CONST=NCBT
      DO 340 I=1,NTIC,NCBT
      DXB=-TICK*A*STH*.7
      DYB=TICK*A*CTH*.7
      IF(MOD(I-1,IMMET).NE.0) GO TO 330
      DXB=DXB*2.0
      DYB=DYB*2.0
330   CALL PLOT_R(XN,YN,2)
D     WRITE(6,*)'AXIS',XN,YN,2
      CALL PLOT_R(XN+DXB,YN+DYB,2)
      CALL PLOT_R(XN,YN,2)
      XN=XN+CTH*CONST
      YN=YN+STH*CONST
C
C    TAKE CARE OF LAST SEGMENT
C
      IF(NTIC-I .GE. NCBT) GO TO 340
      XN=XN+CTH*(NTIC-I-CONST)
      YN=YN+STH*(NTIC-I-CONST)
      CALL PLOT_R(XN,YN,2)
D     WRITE(6,*)'AXIS',XN,YN,3
340   CONTINUE
350   RETURN
      END
